apiVersion: v1
kind: ConfigMap
metadata:
  name: ssh
  namespace: "vector-db-ci"
data:
  authorized_keys: |
    ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDavaHYcj+lc7pNOtnJijxdiLT/rsuCdHEoF4Anj6/il2fWUVKg9OIZc/6PCRC3HY+GRjsdQ3sifjiAftV0qnW+KhlzcYp0hJfrTz8g5MJL+3sZ2pgvW1QEXvJzaQ3E68YxK0yLWioIUPB/fla3bc2iyYUhtV3EUwEvXNV6OLjPUf4fJYTjR8R0bczttU8s6v+6wgSyeT7xV3jgNWavQt8+uY8h2J+3UAKmt9AQoesZUgzxVfUQfqRam9/JZ+EepED7uJl635Obp/4hZ2dxlMfFZzURWko+vJx1NPttoD1Y6oU3tfGuf3oNAuoVmP2uUoE9vUz++BI7B79mskW5ypZF yim@moqi.ai

    ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCx8ZyGMf+BQRj5L2/G4Vw9jrRtpUg3OY2zpKmzJyMxHAuvLl2F6OUXD9hoKPJdMGqWT4qXtVFO8X6ET5PzHFxOHCLm3G8hFNP4rFOlvPgo0p1QpKhjKPxOvYs0rQYbSpcn9g3MCVfLme1GcJ5rliFspXPKdC1i5Q5FsbsIVjZ6z9f6KWBJXOyYfomeeVyhgFRSKbH+uzpDvHo1DVRBlZmWCG4IYSYiCDwYul5whetsM529RJMmhAs4VWgLErQGlUPjIMkiQQ9g9xL2Xc2w6kDPrOtcWDi0G4WytTDglmSgTPzpVH2SFcCgoJGavv5Fw7Qpfc5COsDeZzVMvzk1p/4uazx5HNl1hBpTnZxNtxIMJCfUJob4sBiajLpLHgQTSjLEhOHKipIPOuJHI/WjzC1pP2qDlfG0kGgDiC+5fup/SaSFXMBPpHQvg0sxQteNDS1AJG01DJorr+GKjULpFWfjUT7931zS4eN2G/nnT05tLJfJJehkuW34+rrSGHnZYF8= tianxinhui@txhmac.local

    ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGZCIocYuZu8QrqeYxq2yiPrdN+kEK4iBt+llVdnYXK+62y1FisabYI/UwcvQ+gsNKjEnZLYhFVMbBUfJxYTVqO70kcW1kXzuP/vFBjM5k/VJy7/BrmnA1svFPxsWkmB1lu01QihSkxBTlB6AQFrfBduDtI4Yrmh3cuHEKDbpUJsHYA7JSyuIxGtCz1Qikv6L02j/NIny6X8FfWVwYz8FiwLVH7LrIuSPgESbqHwx9x/l3e6Z5KFQoxUy8QNy7vZVVWLiwJ6655SilwpOTR/a6BLyl94g5Fi7EytWPpIP+VoH7STLjXu7Emq8gZhK48CvTNR/locZg6OMCmr+0I/xn qliu@macbook

    ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC7dt7gXgqqwqruiEyQrOmHP3Wj/vVrrvyhNP6Y0AuIDug5smw1T7VDr/cwonmSphOiJ2eSlBN42A3ZYcQvO2kSdf01ba/i2s0WHaUYU7/xVxYRoejzjEahF3LxWfja2jvSViqG1FwdCIHkhPLjzyeWJMrt1IjqVb/1qTQoOHWi+agpgY+6AtwYLWEZlbrmb1Y2ve6mvyMq5u/8OddVCF04gOGfLBCv9aYg+AS3iVZmgqoG03MW12zi8SgFeTcynGx6an6zRhPjS4JPRQAO/dAhZrTHLBozdV9j6Sg0xXeNU+lf3kbibvTOwJVXKyx3f0xeTg8G2k4epiR9pEPDJezVInytciVs7bbD4jZNTT93bztRHwOjxeoGFt6ZsnhSI54C8854QRhC4QjHIbEEU5yycTNF1S+5jf5plhEIe2Y/X/h05PIJ/jdVxGVeUS4M8H7ZXaZo6XiBvdR1QOizyQeBZKbcfwSWk/L5P4CbAET4AwIJAWhlPvWYuIgtV06W5Ns= mochix@moqi.ai

    ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC3RLMpNsZkn3Kkdej2ndwoFAk1ZJFcEDtn2YzGTY6uwAsMTDjG9W06ky4X9XuOiwyw6Jiid6MYJ3NdnH1rsQ0BmISCZS/dySNG1HbfLKPb4yBl/uH8DvaHfziGn0H8BHWaL/2lJIP4SJcK5Pxe39ugVuO9UVWyT5I67voSS1nK903Qx2Adx2fxLTWFdBx/zYauwOXQjsIjN205baTwJse7x1WSNhCxP6g+KywElqLnWkOj0gDTca8ESd7ksyBecrzu4kMrUL+2AIuCWBL8VdR+vGI17Fw9W5P1ufJ/Xhz3q7z/AO9rHV/nRTQF3xACtrIaetPZnCZ9x6HE7EbYJXZe2kDKrHdQ0hOcWkhFGmiLXkwSrFukaTtJknFiSt4LY3EogU+kMmaOWEDrjuEGnyz8m3Ik/lK99dAarFkFimhjgVBOyb0HDMmKzsM2C9zdBfL2/EwsYG3zyW5qWy/7cjrvI1ov3hpz2TF9B7i26avKVfMW05pOhD7vI9KYAG96t4E= haol@haoldeMacBook-Pro.local

    ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPyTd+Xjqy/oA6qtKc1tS9WIbvg4RIig6eH8a9YMJJHz moqi_dev_vm_peer_mac

    ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC1fp4AowQfheVR9ex54IuYOKp8t1Zub8iJCgxlBlcTlCkSv/yWO8fty0EysMq0QEgZIsa3j5sF3l6+HLkoR2CJ360k0q+TgAEoC6uEZYnwlxtybRCj0c36YP3Ttmn21dhazAZ+AOWCdrXh8rOthEqtR3gZ+IZ4mJAc6UEXIKbXp4etO6Nswpr04Z4Z6T0735p1Un42FDJ35x7UHKPP1ItNXEhrnNin/dq81Yi6KtiaZICpxOOMpH6MQngtxzfM+q1BfExf5XWyKKeMeZv5+iYAkcg8nzSmAgSg32CBvkxoi6TJOIGzcgJRxBjBcFRTA8JwaMa5HuSjNAl/40OVCUvjSoORA/k5WUWbwy9QVfXPDapiHuqGdJgbqmkkwSzZgebTNIv6W0YsXKW/mGnyfIOwbNWFtS06afr7/V8TZ8x2NfqbNZM5mMZbkfeXF0NEGFftFHaIpwnaVZh1ktOS7w5Qt2wqILzjQ0bqFpDh4kEwAewJpawkTh+smkSI3hpC4N0= jianmeiz@kaiydeMacBook-Pro.local

    ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCgv9qrP/B/ho1IDo47uVoUQPQNrr4AEtUbeJf6ZUkq+Zm2t6hxaFrNiiO3CKG/Ii1GiJxrzVf1ypN6Hj5nJl/rRYzJTJM/4imONUW4YWVPBzQusSZuqd7u8C+eNanwy1d1iazYHbz3OiiVd3KpXeOUTr1QttsCko2uryKr8ZS1sc6k85E/NW635LSzOhSKTEEIWihMvtLprYA2vinDDEXbh9IywUEEhTXZzeip0INY7IxaAamLlYkfv2r4h1di322ThqygHNY6GCevYKqcGXx/WBNRDVeC0hQ0R543IdOHbvcpZRNhC/puI7pb3mnYRO29zZ5/H5lBpj04dLi7tiefbCoYyD5wyHwSi/mHTLnRpaK27V8+UWlEeAXtKMo14kWSIVSkZ1eqvYksD3w7v+kfYgGjbPRuaaDzPQLgkRLMd8cqrPqJSdHvpzyk55lKyc3wA7INCi7AntpTFwJ7HdJK+pQu9oFTzVu8qcx2oBI1XWC6EoHzPAJGqz6nCTTxKzU= “shanfengp@moqi.ai”
---
apiVersion: "clickhouse.altinity.com/v1"
kind: "ClickHouseInstallation"
metadata:
  name: "testing"
  namespace: "vector-db-ci"
spec:
  defaults:
    templates:
      serviceTemplate: service-template
      replicaServiceTemplate: replica-service-template
      podTemplate: pod-template
      dataVolumeClaimTemplate: data-volume-claim-template
      logVolumeClaimTemplate: log-volume-claim-template

  configuration:
    settings:
      logger/level: error
      logger/size: 2000M
      logger/count: 100
      max_concurrent_queries: 10000
      merge_tree/min_rows_to_build_vector_index: 0
      query_log/database: system
      query_log/table: query_log
      query_log/partition_by: toYYYYMMDD(event_date)
      query_log/ttl: event_date + INTERVAL 3 DAY DELETE
      query_log/flush_interval_milliseconds: 7500
    users:
      default/networks/ip:
        - "127.0.0.1"
        - "::1"
        - "0.0.0.0/0"
    profiles:
      default/allow_experimental_lightweight_delete: true
      default/mutations_sync: 1
      default/log_query_threads: 0
      default/log_queries_cut_to_length: 1000
    clusters:
      - name: "testing"
        layout:
          shardsCount: 1
          replicasCount: 1
  templates:
    serviceTemplates:
      - name: service-template
        metadata:
          annotations:
            # service.kubernetes.io/qcloud-loadbalancer-internal-subnetid: subnet-ezx6t8lt
            # service.kubernetes.io/qcloud-loadbalancer-internal-subnetid: subnet-q5eu0w59
            service.kubernetes.io/qcloud-loadbalancer-internal-subnetid: subnet-itzzzhyz
        spec:
          type: LoadBalancer
          ports:
            - name: http
              port: 8123
              protocol: TCP
              targetPort: http
            - name: tcp
              port: 9000
              protocol: TCP
              targetPort: tcp
            - name: ssh
              port: 22
              protocol: TCP
              targetPort: ssh
      - name: replica-service-template
        spec:
          type: ClusterIP
          clusterIP: None
          ports:
            - name: http
              port: 8123
              protocol: TCP
              targetPort: http
            - name: tcp
              port: 9000
              protocol: TCP
              targetPort: tcp
            - name: interserver
              port: 9009
              protocol: TCP
              targetPort: interserver
            - name: metrics
              port: 9363
              protocol: TCP
              targetPort: metrics
    podTemplates:
      - name: pod-template
        spec:
          containers:
            - name: clickhouse
              image: harbor.internal.moqi.ai/mqdb/mqdb:IMAGE_VERSION
              # image: harbor.internal.moqi.ai/mqdb/mqdb:22.3.7.5-dc6971d6e
              ports:
                - containerPort: 9000
                  name: tcp
                  protocol: TCP
                - containerPort: 8123
                  name: http
                  protocol: TCP
                - containerPort: 9009
                  name: interserver
                  protocol: TCP
                - containerPort: 9363
                  name: metrics
                  protocol: TCP
              resources:
                requests:
                  cpu: 4
                  memory: 8Gi
                limits:
                  cpu: 4
                  memory: 8Gi
          volumes:
            - name: ssh
              configMap:
                name: ssh
                defaultMode: 0600

    volumeClaimTemplates:
      - name: data-volume-claim-template
        spec:
          accessModes:
            - ReadWriteOnce
          resources:
            requests:
              storage: 200Gi
      - name: log-volume-claim-template
        spec:
          accessModes:
            - ReadWriteOnce
          resources:
            requests:
              storage: 20Gi